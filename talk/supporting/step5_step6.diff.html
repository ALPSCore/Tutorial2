<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.36 in css mode. -->
<html>
  <head>
    <title>step5_step6.diff</title>
    <style type="text/css">
    <!--
      body {
        color: #000000;
        background-color: #ffffff;
      }
      .diff-added {
        /* diff-added */
        background-color: #ddffdd;
      }
      .diff-context {
        /* diff-context */
        color: #7f7f7f;
      }
      .diff-file-header {
        /* diff-file-header */
        background-color: #b3b3b3;
        font-weight: bold;
      }
      .diff-header {
        /* diff-header */
        background-color: #cccccc;
      }
      .diff-hunk-header {
        /* diff-hunk-header */
        background-color: #cccccc;
      }
      .diff-indicator-added {
        /* diff-indicator-added */
        background-color: #ddffdd;
      }
      .diff-indicator-removed {
        /* diff-indicator-removed */
        background-color: #ffdddd;
      }
      .diff-removed {
        /* diff-removed */
        background-color: #ffdddd;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
<h2>Unified diff: <tt>step5_pi_checkpoint</tt> <i>vs.</i> <tt>step6_pi_mpi</tt></h2>
    <pre>
<span class="diff-context">Files step5_pi_checkpoint/CMakeLists.txt and step6_pi_mpi/CMakeLists.txt are identical

diff -N -u -r -b -s step5_pi_checkpoint/main.cpp step6_pi_mpi/main.cpp
</span><span class="diff-header">--- </span><span class="diff-header"><span class="diff-file-header">step5_pi_checkpoint/main.cpp</span></span><span class="diff-header">        2016-06-15 14:12:52.874919385 -0400
+++ </span><span class="diff-header"><span class="diff-file-header">step6_pi_mpi/main.cpp</span></span><span class="diff-header">       2016-06-15 13:43:10.271002476 -0400
</span><span class="diff-hunk-header">@@ -1,29 +1,39 @@</span>
<span class="diff-context"> #include &lt;iostream&gt;
 #include &lt;alps/mc/stop_callback.hpp&gt;
</span><span class="diff-indicator-added">+</span><span class="diff-added">#include &lt;alps/mc/mpiadapter.hpp&gt;
</span><span class="diff-indicator-added">+</span><span class="diff-added">
</span><span class="diff-context"> #include "simulation.hpp"
 
 int main(int argc, char** argv)
 {
     // Define shorthand:
</span><span class="diff-indicator-removed">-</span><span class="diff-removed">    typedef MySimulation mysim_type;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    typedef alps::mcmpiadapter&lt;MySimulation&gt; mysim_type;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    
</span><span class="diff-indicator-added">+</span><span class="diff-added">    // init MPI, obtain communicator
</span><span class="diff-indicator-added">+</span><span class="diff-added">    alps::mpi::environment mpi_env(argc, argv);
</span><span class="diff-indicator-added">+</span><span class="diff-added">    alps::mpi::communicator comm;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    // remember the rank
</span><span class="diff-indicator-added">+</span><span class="diff-added">    const int rank=comm.rank();
</span><span class="diff-indicator-added">+</span><span class="diff-added">    const bool is_master=(0==rank);
</span><span class="diff-context">     
     // Parse the parameters
</span><span class="diff-indicator-removed">-</span><span class="diff-removed">    alps::params p(argc, (const char**)argv);
</span><span class="diff-indicator-added">+</span><span class="diff-added">    alps::params p(argc, (const char**)argv, comm);
</span><span class="diff-context"> 
     // Define the parameters
</span><span class="diff-indicator-removed">-</span><span class="diff-removed">    mysim_type::define_parameters(p)
</span><span class="diff-indicator-removed">-</span><span class="diff-removed">        .define&lt;std::size_t&gt;("timelimit", 5, "Time limit for the computation");
</span><span class="diff-indicator-added">+</span><span class="diff-added">    mysim_type::define_parameters(p);
</span><span class="diff-context">         
     if (p.help_requested(std::cerr) || p.has_missing(std::cerr))
         return 1;
 
     std::cout &lt;&lt; "Creating simulation"
</span><span class="diff-indicator-added">+</span><span class="diff-added">              &lt;&lt; " on rank " &lt;&lt; rank
</span><span class="diff-context">               &lt;&lt; std::endl;
 
</span><span class="diff-indicator-removed">-</span><span class="diff-removed">    mysim_type mysim(p);
</span><span class="diff-indicator-added">+</span><span class="diff-added">    mysim_type mysim(p,comm);
</span><span class="diff-context"> 
     // If needed, restore the last checkpoint
     std::string checkpoint_file = p["checkpoint"].as&lt;std::string&gt;();
</span><span class="diff-indicator-added">+</span><span class="diff-added">    if (!is_master) checkpoint_file += "."+boost::lexical_cast&lt;std::string&gt;(rank);
</span><span class="diff-context">         
     if (p.is_restored()) {
         std::cout &lt;&lt; "Restoring checkpoint from " &lt;&lt; checkpoint_file
</span>
<br>
<br>
<br>
<span class="diff-hunk-header">@@ -32,23 +42,29 @@</span>
<span class="diff-context">     }
 
     std::cout &lt;&lt; "Starting simulation"
</span><span class="diff-indicator-added">+</span><span class="diff-added">              &lt;&lt; " on rank " &lt;&lt; rank
</span><span class="diff-context">               &lt;&lt; std::endl;
 
     mysim.run(alps::stop_callback(std::size_t(p["timelimit"])));
 
     std::cout &lt;&lt; "Simulation finished"
</span><span class="diff-indicator-added">+</span><span class="diff-added">              &lt;&lt; " on rank " &lt;&lt; rank
</span><span class="diff-context">               &lt;&lt; std::endl;
 
     std::cout &lt;&lt; "Saving to checkpoint " &lt;&lt; checkpoint_file
</span><span class="diff-indicator-added">+</span><span class="diff-added">              &lt;&lt; " on rank " &lt;&lt; rank
</span><span class="diff-context">               &lt;&lt; std::endl;
 
     mysim.save(checkpoint_file);
 
     std::cout &lt;&lt; "Collecting results..."
</span><span class="diff-indicator-added">+</span><span class="diff-added">              &lt;&lt; " on rank " &lt;&lt; rank
</span><span class="diff-context">               &lt;&lt; std::endl;
     
     alps::accumulators::result_set results=mysim.collect_results();
 
</span><span class="diff-indicator-added">+</span><span class="diff-added">    // Do printing only on master:
</span><span class="diff-indicator-added">+</span><span class="diff-added">    if (is_master) {
</span><span class="diff-context">     // Print all results:
     std::cout &lt;&lt; "All results:\n" &lt;&lt; results &lt;&lt; std::endl;
 
</span><span class="diff-hunk-header">@@ -78,6 +94,7 @@</span>
<span class="diff-context">     alps::hdf5::archive ar(output_file, "w");
     ar["/parameters"] &lt;&lt; p;
     ar["/simulation/results"] &lt;&lt; results;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    }
</span><span class="diff-context"> 
     return 0;
 }

Files step5_pi_checkpoint/simulation.cpp and step6_pi_mpi/simulation.cpp are identical

Files step5_pi_checkpoint/simulation.hpp and step6_pi_mpi/simulation.hpp are identical
</span></pre>
  </body>
</html>
