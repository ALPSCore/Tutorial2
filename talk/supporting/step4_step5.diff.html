<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.36 in css mode. -->
<html>
  <head>
    <title>step4_step5.diff</title>
    <style type="text/css">
    <!--
      body {
        color: #000000;
        background-color: #ffffff;
      }
      .diff-added {
        /* diff-added */
        background-color: #ddffdd;
      }
      .diff-context {
        /* diff-context */
        color: #7f7f7f;
      }
      .diff-file-header {
        /* diff-file-header */
        background-color: #b3b3b3;
        font-weight: bold;
      }
      .diff-header {
        /* diff-header */
        background-color: #cccccc;
      }
      .diff-hunk-header {
        /* diff-hunk-header */
        background-color: #cccccc;
      }
      .diff-indicator-added {
        /* diff-indicator-added */
        background-color: #ddffdd;
      }
      .diff-indicator-removed {
        /* diff-indicator-removed */
        background-color: #ffdddd;
      }
      .diff-removed {
        /* diff-removed */
        background-color: #ffdddd;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
<h2>Unified diff: <tt>step4_pi</tt> <i>vs.</i> <tt>step5_pi_checkpoint</tt></h2>
    <pre>
<span class="diff-context">Files step4_pi/CMakeLists.txt and step5_pi_checkpoint/CMakeLists.txt are identical

diff -N -u -r -b -s step4_pi/main.cpp step5_pi_checkpoint/main.cpp
</span><span class="diff-header">--- </span><span class="diff-header"><span class="diff-file-header">step4_pi/main.cpp</span></span><span class="diff-header">   2016-06-15 14:36:39.478852887 -0400
+++ </span><span class="diff-header"><span class="diff-file-header">step5_pi_checkpoint/main.cpp</span></span><span class="diff-header">        2016-06-15 14:12:52.874919385 -0400
</span><span class="diff-hunk-header">@@ -22,14 +22,29 @@</span>
<span class="diff-context"> 
     mysim_type mysim(p);
 
</span><span class="diff-indicator-added">+</span><span class="diff-added">    // If needed, restore the last checkpoint
</span><span class="diff-indicator-added">+</span><span class="diff-added">    std::string checkpoint_file = p["checkpoint"].as&lt;std::string&gt;();
</span><span class="diff-indicator-added">+</span><span class="diff-added">        
</span><span class="diff-indicator-added">+</span><span class="diff-added">    if (p.is_restored()) {
</span><span class="diff-indicator-added">+</span><span class="diff-added">        std::cout &lt;&lt; "Restoring checkpoint from " &lt;&lt; checkpoint_file
</span><span class="diff-indicator-added">+</span><span class="diff-added">                  &lt;&lt; std::endl;
</span><span class="diff-indicator-added">+</span><span class="diff-added">        mysim.load(checkpoint_file);
</span><span class="diff-indicator-added">+</span><span class="diff-added">    }
</span><span class="diff-indicator-added">+</span><span class="diff-added">
</span><span class="diff-context">     std::cout &lt;&lt; "Starting simulation"
               &lt;&lt; std::endl;
 
     mysim.run(alps::stop_callback(std::size_t(p["timelimit"])));
 
     std::cout &lt;&lt; "Simulation finished"
</span><span class="diff-indicator-removed">-</span><span class="diff-removed">              &lt;&lt; std::endl
</span><span class="diff-indicator-removed">-</span><span class="diff-removed">              &lt;&lt; "Collecting results..."
</span><span class="diff-indicator-added">+</span><span class="diff-added">              &lt;&lt; std::endl;
</span><span class="diff-indicator-added">+</span><span class="diff-added">
</span><span class="diff-indicator-added">+</span><span class="diff-added">    std::cout &lt;&lt; "Saving to checkpoint " &lt;&lt; checkpoint_file
</span><span class="diff-indicator-added">+</span><span class="diff-added">              &lt;&lt; std::endl;
</span><span class="diff-indicator-added">+</span><span class="diff-added">
</span><span class="diff-indicator-added">+</span><span class="diff-added">    mysim.save(checkpoint_file);
</span><span class="diff-indicator-added">+</span><span class="diff-added">
</span><span class="diff-indicator-added">+</span><span class="diff-added">    std::cout &lt;&lt; "Collecting results..."
</span><span class="diff-context">               &lt;&lt; std::endl;
     
     alps::accumulators::result_set results=mysim.collect_results();
</span><span class="diff-hunk-header">@@ -57,5 +72,12 @@</span>
<span class="diff-context">               &lt;&lt; pi_res.autocorrelation&lt;double&gt;()
               &lt;&lt; std::endl;
 
</span><span class="diff-indicator-added">+</span><span class="diff-added">    // Saving to the output file
</span><span class="diff-indicator-added">+</span><span class="diff-added">    std::string output_file = p["outputfile"];
</span><span class="diff-indicator-added">+</span><span class="diff-added">    std::cout &lt;&lt; "Saving results to " &lt;&lt; output_file &lt;&lt; std::endl;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    alps::hdf5::archive ar(output_file, "w");
</span><span class="diff-indicator-added">+</span><span class="diff-added">    ar["/parameters"] &lt;&lt; p;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    ar["/simulation/results"] &lt;&lt; results;
</span><span class="diff-indicator-added">+</span><span class="diff-added">
</span><span class="diff-context">     return 0;
 }
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
diff -N -u -r -b -s step4_pi/simulation.cpp step5_pi_checkpoint/simulation.cpp
</span><span class="diff-header">--- </span><span class="diff-header"><span class="diff-file-header">step4_pi/simulation.cpp</span></span><span class="diff-header">     2016-06-15 12:31:08.191203939 -0400
+++ </span><span class="diff-header"><span class="diff-file-header">step5_pi_checkpoint/simulation.cpp</span></span><span class="diff-header">  2016-06-15 12:46:51.367159975 -0400
</span><span class="diff-hunk-header">@@ -1,5 +1,6 @@</span>
<span class="diff-context"> #include "simulation.hpp"
 #include &lt;cmath&gt;
</span><span class="diff-indicator-added">+</span><span class="diff-added">#include &lt;alps/params/convenience_params.hpp&gt;
</span><span class="diff-context"> 
 bool MySimulation::is_inside_area(double x, double y) {
     // Let it be just a 1x1 square centered at (0,0)
</span><span class="diff-hunk-header">@@ -58,6 +59,10 @@</span>
<span class="diff-context"> }
 
 MySimulation::parameters_type&amp; MySimulation::define_parameters(MySimulation::parameters_type&amp; params) {
</span><span class="diff-indicator-added">+</span><span class="diff-added">    // Do not redefine if we are restoring from the checkpoint:
</span><span class="diff-indicator-added">+</span><span class="diff-added">    if (params.is_restored()) return params;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    // Add convenience parameters:
</span><span class="diff-indicator-added">+</span><span class="diff-added">    alps::define_convenience_parameters(params);
</span><span class="diff-context">     // Parameters defined by base class:
     return alps::mcbase::define_parameters(params)
         // and by our class:
</span><span class="diff-hunk-header">@@ -66,3 +71,31 @@</span>
<span class="diff-context">         .define&lt;long&gt;("burn-in", 10000, "Number of steps before taking measurements")
         .define&lt;double&gt;("step", "Maximum size of a trial step");
 }
</span><span class="diff-indicator-added">+</span><span class="diff-added">
</span><span class="diff-indicator-added">+</span><span class="diff-added">// Saves the state to the hdf5 file
</span><span class="diff-indicator-added">+</span><span class="diff-added">void MySimulation::save(alps::hdf5::archive &amp; ar) const {
</span><span class="diff-indicator-added">+</span><span class="diff-added">    // Most of the save logic is already implemented in the base class
</span><span class="diff-indicator-added">+</span><span class="diff-added">    alps::mcbase::save(ar);
</span><span class="diff-indicator-added">+</span><span class="diff-added">    
</span><span class="diff-indicator-added">+</span><span class="diff-added">    // We just need to add our own internal state
</span><span class="diff-indicator-added">+</span><span class="diff-added">    ar["checkpoint/istep"] &lt;&lt; istep_;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    ar["checkpoint/x"] &lt;&lt; x_;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    ar["checkpoint/y"] &lt;&lt; y_;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    // The rest of the internal state is saved as part of the parameters
</span><span class="diff-indicator-added">+</span><span class="diff-added">}
</span><span class="diff-indicator-added">+</span><span class="diff-added">
</span><span class="diff-indicator-added">+</span><span class="diff-added">// Loads the state from the hdf5 file
</span><span class="diff-indicator-added">+</span><span class="diff-added">void MySimulation::load(alps::hdf5::archive &amp; ar) {
</span><span class="diff-indicator-added">+</span><span class="diff-added">    // Most of the load logic is already implemented in the base class
</span><span class="diff-indicator-added">+</span><span class="diff-added">    alps::mcbase::load(ar);
</span><span class="diff-indicator-added">+</span><span class="diff-added">
</span><span class="diff-indicator-added">+</span><span class="diff-added">    // Restore the internal state that came from parameters
</span><span class="diff-indicator-added">+</span><span class="diff-added">    burnin_ = parameters["burn-in"];
</span><span class="diff-indicator-added">+</span><span class="diff-added">    maxcount_ = parameters["count"];
</span><span class="diff-indicator-added">+</span><span class="diff-added">    stepsize_ = parameters["step"];
</span><span class="diff-indicator-added">+</span><span class="diff-added">
</span><span class="diff-indicator-added">+</span><span class="diff-added">    // Restore the rest of the state from the hdf5 file
</span><span class="diff-indicator-added">+</span><span class="diff-added">    ar["checkpoint/istep"] &gt;&gt; istep_;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    ar["checkpoint/x"] &gt;&gt; x_;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    ar["checkpoint/y"] &gt;&gt; y_;
</span><span class="diff-indicator-added">+</span><span class="diff-added">}
</span><span class="diff-context">
diff -N -u -r -b -s step4_pi/simulation.hpp step5_pi_checkpoint/simulation.hpp
</span><span class="diff-header">--- </span><span class="diff-header"><span class="diff-file-header">step4_pi/simulation.hpp</span></span><span class="diff-header">     2016-06-15 12:27:23.359214419 -0400
+++ </span><span class="diff-header"><span class="diff-file-header">step5_pi_checkpoint/simulation.hpp</span></span><span class="diff-header">  2016-06-15 12:27:23.975214390 -0400
</span><span class="diff-hunk-header">@@ -27,4 +27,9 @@</span>
<span class="diff-context">     double fraction_completed() const;
     
     static parameters_type&amp; define_parameters(parameters_type&amp;);        
</span><span class="diff-indicator-added">+</span><span class="diff-added">
</span><span class="diff-indicator-added">+</span><span class="diff-added">    using alps::mcbase::save;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    using alps::mcbase::load;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    void save(alps::hdf5::archive &amp; ar) const;
</span><span class="diff-indicator-added">+</span><span class="diff-added">    void load(alps::hdf5::archive &amp; ar);
</span><span class="diff-context"> };
</span></pre>
  </body>
</html>
